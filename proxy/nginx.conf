# --- 백엔드 서버 그룹 정의 ---
upstream user_api {
    server user-backend:8080;
}
upstream management_api {
    server management-backend:8080;
}

server {
    listen 80;
    server_name www.hotelhub.store hotelhub.store;

    # --- API 경로 분기 ---
    # /api/admin 으로 시작하는 요청은 관리자 백엔드로 전달
    location /api/admin {
        proxy_pass http://management_api;
    }
    location /api/business {
        proxy_pass http://management_api;
    }
    # /api 로 시작하는 그 외 모든 요청은 사용자 백엔드로 전달
    location /api {
        proxy_pass http://user_api;
    }

    # --- 프론트엔드 경로 분기 ---
    # /admin 으로 시작하는 요청은 관리자 프론트엔드로 전달
    location /admin {
        proxy_pass http://admin-frontend:80;
    }
    # /business 으로 시작하는 요청은 사업자 프론트엔드로 전달
    location /business {
        proxy_pass http://business-frontend:80;
    }
    # 그 외 모든 요청은 사용자 프론트엔드로 전달 (SPA 설정 포함)
    location / {
        proxy_pass http://user-frontend:80;
        try_files $uri $uri/ /index.html; # 사용자 프론트엔드 SPA 설정
    }
